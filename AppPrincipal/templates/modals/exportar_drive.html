<div class="modal-header">
    <h3><i class="fas fa-cloud-download-alt"></i> Exportar Período a Google Drive</h3>
    <button type="button" class="modal-close" onclick="cerrarModal()">&times;</button>
</div>

<div class="modal-body">
    <div class="export-info">
        <div class="periodo-info">
            <h4><i class="fas fa-calendar-alt"></i> {{ periodo.nombre }} {{ periodo.año }}</h4>
            <p>{{ periodo.descripcion|default:"Sin descripción" }}</p>
        </div>

        <div class="export-stats">
            <div class="stat-item">
                <i class="fas fa-folder"></i>
                <span>{{ carpetas.count }} carpetas</span>
            </div>
            <div class="stat-item">
                <i class="fas fa-file"></i>
                <span>{{ total_archivos }} archivos</span>
            </div>
        </div>
    </div>

    <div class="export-options">
        <h5><i class="fas fa-cog"></i> Opciones de Exportación</h5>
        
        <div class="option-group">
            <h6>Formato de Exportación:</h6>
            <div class="radio-group">
                <label>
                    <input type="radio" name="export_format" value="zip" checked>
                    <i class="fas fa-file-archive"></i> Descargar como ZIP
                    <small>Descarga directa de todas las carpetas y archivos</small>
                </label>
                <label>
                    <input type="radio" name="export_format" value="drive" disabled>
                    <i class="fab fa-google-drive"></i> Exportar a Google Drive
                    <small>Próximamente disponible</small>
                </label>
            </div>
        </div>

        <div class="option-group">
            <h6>Contenido a Exportar:</h6>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" checked disabled>
                    <i class="fas fa-folder"></i> Estructura de carpetas
                </label>
                <label>
                    <input type="checkbox" checked>
                    <i class="fas fa-file"></i> Archivos
                </label>
                <label>
                    <input type="checkbox">
                    <i class="fas fa-info-circle"></i> Metadatos
                </label>
            </div>
        </div>
    </div>

    <div class="folder-preview">
        <h5><i class="fas fa-eye"></i> Vista Previa del Contenido</h5>
        <div class="folder-list">
            {% for carpeta in carpetas %}
            <div class="folder-item">
                <div class="folder-header">
                    <i class="fas fa-folder"></i>
                    <span>{{ carpeta.nombre }}</span>
                    <small>({{ carpeta.archivos.count }} archivos)</small>
                </div>
                {% if carpeta.subcarpetas.exists %}
                <div class="subfolder-list">
                    {% for subcarpeta in carpeta.subcarpetas.all %}
                    <div class="subfolder-item">
                        <i class="fas fa-folder-open"></i>
                        <span>{{ subcarpeta.nombre }}</span>
                        <small>({{ subcarpeta.archivos.count }} archivos)</small>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<div class="modal-footer">
    <button type="button" class="btn btn-secondary" onclick="cerrarModal()">
        <i class="fas fa-times"></i> Cancelar
    </button>
    <button type="button" class="btn btn-primary" onclick="iniciarExportacion()">
        <i class="fas fa-download"></i> Descargar ZIP
    </button>
</div>

<script>
function iniciarExportacion() {
    const format = document.querySelector('input[name="export_format"]:checked').value;
    
    if (format === 'zip') {
        // Mostrar progreso
        Swal.fire({
            title: 'Preparando exportación...',
            text: 'Esto puede tomar unos momentos',
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });
        
        // Iniciar descarga
        window.location.href = '{% url "exportar_periodo_zip" periodo.id %}';
        
        // Cerrar modal después de un momento
        setTimeout(() => {
            Swal.close();
            cerrarModal();
            Swal.fire({
                icon: 'success',
                title: 'Exportación iniciada',
                text: 'La descarga comenzará automáticamente',
                timer: 3000,
                showConfirmButton: false
            });
        }, 2000);
    }
}
</script>

<style>
.export-info {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.periodo-info h4 {
    margin: 0 0 10px 0;
    color: #007bff;
}

.export-stats {
    display: flex;
    gap: 20px;
    margin-top: 15px;
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #666;
}

.export-options {
    margin-bottom: 20px;
}

.option-group {
    margin-bottom: 20px;
}

.option-group h6 {
    margin-bottom: 10px;
    color: #333;
}

.radio-group label,
.checkbox-group label {
    display: block;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    margin-bottom: 5px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.radio-group label:hover,
.checkbox-group label:hover {
    background: #f8f9fa;
    border-color: #007bff;
}

.radio-group label small,
.checkbox-group label small {
    display: block;
    color: #666;
    margin-top: 5px;
}

.folder-preview {
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 15px;
}

.folder-item {
    margin-bottom: 15px;
}

.folder-header {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: bold;
    color: #007bff;
}

.subfolder-list {
    margin-left: 20px;
    margin-top: 10px;
}

.subfolder-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 5px 0;
    color: #666;
}
</style>